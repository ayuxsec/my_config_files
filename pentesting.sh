ipinfo() {
  local base_url="https://ipinfo.io"
  [ "$#" -eq 0 ] && { echo "Usage: ipinfo <ip_addr>"; return 1; }
  [[ -v ipinfo_api_key ]] && { curl -s "$base_url/$1" -H  "Authorization: Bearer ${ipinfo_api_key}"; return 0; }
  curl -s $base_url/$1
}

kt_crawl() {
  # Default values
  local in="httpx.txt"
  local out="kt_crawled.txt"
  local td="15"
  local ptd="5"
  local depth="6"
  local dur="15m"

  # Usage/Help
  usage() {
    echo "Usage: kt_crawl [options]"
    echo "Options:"
    echo "  -i <file>     Input hosts file (default: httpx.txt)"
    echo "  -o <file>     Output file (default: kt_crawled.txt)"
    echo "  -t <int>      Threads (default: 15)"
    echo "  -p <int>      Parallelism Threads (default: 5)"
    echo "  -d <int>      Depth (default: 6)"
    echo "  -m <duration> Max duration (default: 15m)"
    echo "  -h            Display help"
  }

  # Parse flags
  local OPTIND
  while getopts "i:o:t:p:d:m:h" opt; do
    case "$opt" in
      i) in=$OPTARG ;;
      o) out=$OPTARG ;;
      t) td=$OPTARG ;;
      p) ptd=$OPTARG ;;
      d) depth=$OPTARG ;;
      m) dur=$OPTARG ;;
      h) usage; return 0 ;;
      *) usage; return 1 ;;
    esac
  done
  shift $((OPTIND-1))

  # Execute Katana
  katana -list "$in" -d "$depth" -jc -kf all -fx -xhr -aff -jsl -c "$td" -p "$ptd" \
    -ct "$dur" -o "$out"
}
